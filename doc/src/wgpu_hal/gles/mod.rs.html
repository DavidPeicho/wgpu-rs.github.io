<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Source of the Rust file `wgpu-hal/src/gles/mod.rs`."><meta name="keywords" content="rust, rustlang, rust-lang"><title>mod.rs - source</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../../../normalize.css"><link rel="stylesheet" type="text/css" href="../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../../../dark.css" disabled><link rel="stylesheet" type="text/css" href="../../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../../storage.js"></script><script defer src="../../../source-script.js"></script><script defer src="../../../source-files.js"></script><script defer src="../../../main.js"></script><noscript><link rel="stylesheet" href="../../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../../favicon.svg"></head><body class="rustdoc source"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../../wgpu_hal/index.html"><div class="logo-container"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></div></a><h2 class="location"></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../../wgpu_hal/index.html"><div class="logo-container"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></div></a></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../../wgpu_hal/index.html"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><button type="button">?</button></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../wheel.svg"></a></div></div></form></nav></div><section id="main-content" class="content"><div class="example-wrap"><pre class="line-numbers"><span id="1">1</span>
<span id="2">2</span>
<span id="3">3</span>
<span id="4">4</span>
<span id="5">5</span>
<span id="6">6</span>
<span id="7">7</span>
<span id="8">8</span>
<span id="9">9</span>
<span id="10">10</span>
<span id="11">11</span>
<span id="12">12</span>
<span id="13">13</span>
<span id="14">14</span>
<span id="15">15</span>
<span id="16">16</span>
<span id="17">17</span>
<span id="18">18</span>
<span id="19">19</span>
<span id="20">20</span>
<span id="21">21</span>
<span id="22">22</span>
<span id="23">23</span>
<span id="24">24</span>
<span id="25">25</span>
<span id="26">26</span>
<span id="27">27</span>
<span id="28">28</span>
<span id="29">29</span>
<span id="30">30</span>
<span id="31">31</span>
<span id="32">32</span>
<span id="33">33</span>
<span id="34">34</span>
<span id="35">35</span>
<span id="36">36</span>
<span id="37">37</span>
<span id="38">38</span>
<span id="39">39</span>
<span id="40">40</span>
<span id="41">41</span>
<span id="42">42</span>
<span id="43">43</span>
<span id="44">44</span>
<span id="45">45</span>
<span id="46">46</span>
<span id="47">47</span>
<span id="48">48</span>
<span id="49">49</span>
<span id="50">50</span>
<span id="51">51</span>
<span id="52">52</span>
<span id="53">53</span>
<span id="54">54</span>
<span id="55">55</span>
<span id="56">56</span>
<span id="57">57</span>
<span id="58">58</span>
<span id="59">59</span>
<span id="60">60</span>
<span id="61">61</span>
<span id="62">62</span>
<span id="63">63</span>
<span id="64">64</span>
<span id="65">65</span>
<span id="66">66</span>
<span id="67">67</span>
<span id="68">68</span>
<span id="69">69</span>
<span id="70">70</span>
<span id="71">71</span>
<span id="72">72</span>
<span id="73">73</span>
<span id="74">74</span>
<span id="75">75</span>
<span id="76">76</span>
<span id="77">77</span>
<span id="78">78</span>
<span id="79">79</span>
<span id="80">80</span>
<span id="81">81</span>
<span id="82">82</span>
<span id="83">83</span>
<span id="84">84</span>
<span id="85">85</span>
<span id="86">86</span>
<span id="87">87</span>
<span id="88">88</span>
<span id="89">89</span>
<span id="90">90</span>
<span id="91">91</span>
<span id="92">92</span>
<span id="93">93</span>
<span id="94">94</span>
<span id="95">95</span>
<span id="96">96</span>
<span id="97">97</span>
<span id="98">98</span>
<span id="99">99</span>
<span id="100">100</span>
<span id="101">101</span>
<span id="102">102</span>
<span id="103">103</span>
<span id="104">104</span>
<span id="105">105</span>
<span id="106">106</span>
<span id="107">107</span>
<span id="108">108</span>
<span id="109">109</span>
<span id="110">110</span>
<span id="111">111</span>
<span id="112">112</span>
<span id="113">113</span>
<span id="114">114</span>
<span id="115">115</span>
<span id="116">116</span>
<span id="117">117</span>
<span id="118">118</span>
<span id="119">119</span>
<span id="120">120</span>
<span id="121">121</span>
<span id="122">122</span>
<span id="123">123</span>
<span id="124">124</span>
<span id="125">125</span>
<span id="126">126</span>
<span id="127">127</span>
<span id="128">128</span>
<span id="129">129</span>
<span id="130">130</span>
<span id="131">131</span>
<span id="132">132</span>
<span id="133">133</span>
<span id="134">134</span>
<span id="135">135</span>
<span id="136">136</span>
<span id="137">137</span>
<span id="138">138</span>
<span id="139">139</span>
<span id="140">140</span>
<span id="141">141</span>
<span id="142">142</span>
<span id="143">143</span>
<span id="144">144</span>
<span id="145">145</span>
<span id="146">146</span>
<span id="147">147</span>
<span id="148">148</span>
<span id="149">149</span>
<span id="150">150</span>
<span id="151">151</span>
<span id="152">152</span>
<span id="153">153</span>
<span id="154">154</span>
<span id="155">155</span>
<span id="156">156</span>
<span id="157">157</span>
<span id="158">158</span>
<span id="159">159</span>
<span id="160">160</span>
<span id="161">161</span>
<span id="162">162</span>
<span id="163">163</span>
<span id="164">164</span>
<span id="165">165</span>
<span id="166">166</span>
<span id="167">167</span>
<span id="168">168</span>
<span id="169">169</span>
<span id="170">170</span>
<span id="171">171</span>
<span id="172">172</span>
<span id="173">173</span>
<span id="174">174</span>
<span id="175">175</span>
<span id="176">176</span>
<span id="177">177</span>
<span id="178">178</span>
<span id="179">179</span>
<span id="180">180</span>
<span id="181">181</span>
<span id="182">182</span>
<span id="183">183</span>
<span id="184">184</span>
<span id="185">185</span>
<span id="186">186</span>
<span id="187">187</span>
<span id="188">188</span>
<span id="189">189</span>
<span id="190">190</span>
<span id="191">191</span>
<span id="192">192</span>
<span id="193">193</span>
<span id="194">194</span>
<span id="195">195</span>
<span id="196">196</span>
<span id="197">197</span>
<span id="198">198</span>
<span id="199">199</span>
<span id="200">200</span>
<span id="201">201</span>
<span id="202">202</span>
<span id="203">203</span>
<span id="204">204</span>
<span id="205">205</span>
<span id="206">206</span>
<span id="207">207</span>
<span id="208">208</span>
<span id="209">209</span>
<span id="210">210</span>
<span id="211">211</span>
<span id="212">212</span>
<span id="213">213</span>
<span id="214">214</span>
<span id="215">215</span>
<span id="216">216</span>
<span id="217">217</span>
<span id="218">218</span>
<span id="219">219</span>
<span id="220">220</span>
<span id="221">221</span>
<span id="222">222</span>
<span id="223">223</span>
<span id="224">224</span>
<span id="225">225</span>
<span id="226">226</span>
<span id="227">227</span>
<span id="228">228</span>
<span id="229">229</span>
<span id="230">230</span>
<span id="231">231</span>
<span id="232">232</span>
<span id="233">233</span>
<span id="234">234</span>
<span id="235">235</span>
<span id="236">236</span>
<span id="237">237</span>
<span id="238">238</span>
<span id="239">239</span>
<span id="240">240</span>
<span id="241">241</span>
<span id="242">242</span>
<span id="243">243</span>
<span id="244">244</span>
<span id="245">245</span>
<span id="246">246</span>
<span id="247">247</span>
<span id="248">248</span>
<span id="249">249</span>
<span id="250">250</span>
<span id="251">251</span>
<span id="252">252</span>
<span id="253">253</span>
<span id="254">254</span>
<span id="255">255</span>
<span id="256">256</span>
<span id="257">257</span>
<span id="258">258</span>
<span id="259">259</span>
<span id="260">260</span>
<span id="261">261</span>
<span id="262">262</span>
<span id="263">263</span>
<span id="264">264</span>
<span id="265">265</span>
<span id="266">266</span>
<span id="267">267</span>
<span id="268">268</span>
<span id="269">269</span>
<span id="270">270</span>
<span id="271">271</span>
<span id="272">272</span>
<span id="273">273</span>
<span id="274">274</span>
<span id="275">275</span>
<span id="276">276</span>
<span id="277">277</span>
<span id="278">278</span>
<span id="279">279</span>
<span id="280">280</span>
<span id="281">281</span>
<span id="282">282</span>
<span id="283">283</span>
<span id="284">284</span>
<span id="285">285</span>
<span id="286">286</span>
<span id="287">287</span>
<span id="288">288</span>
<span id="289">289</span>
<span id="290">290</span>
<span id="291">291</span>
<span id="292">292</span>
<span id="293">293</span>
<span id="294">294</span>
<span id="295">295</span>
<span id="296">296</span>
<span id="297">297</span>
<span id="298">298</span>
<span id="299">299</span>
<span id="300">300</span>
<span id="301">301</span>
<span id="302">302</span>
<span id="303">303</span>
<span id="304">304</span>
<span id="305">305</span>
<span id="306">306</span>
<span id="307">307</span>
<span id="308">308</span>
<span id="309">309</span>
<span id="310">310</span>
<span id="311">311</span>
<span id="312">312</span>
<span id="313">313</span>
<span id="314">314</span>
<span id="315">315</span>
<span id="316">316</span>
<span id="317">317</span>
<span id="318">318</span>
<span id="319">319</span>
<span id="320">320</span>
<span id="321">321</span>
<span id="322">322</span>
<span id="323">323</span>
<span id="324">324</span>
<span id="325">325</span>
<span id="326">326</span>
<span id="327">327</span>
<span id="328">328</span>
<span id="329">329</span>
<span id="330">330</span>
<span id="331">331</span>
<span id="332">332</span>
<span id="333">333</span>
<span id="334">334</span>
<span id="335">335</span>
<span id="336">336</span>
<span id="337">337</span>
<span id="338">338</span>
<span id="339">339</span>
<span id="340">340</span>
<span id="341">341</span>
<span id="342">342</span>
<span id="343">343</span>
<span id="344">344</span>
<span id="345">345</span>
<span id="346">346</span>
<span id="347">347</span>
<span id="348">348</span>
<span id="349">349</span>
<span id="350">350</span>
<span id="351">351</span>
<span id="352">352</span>
<span id="353">353</span>
<span id="354">354</span>
<span id="355">355</span>
<span id="356">356</span>
<span id="357">357</span>
<span id="358">358</span>
<span id="359">359</span>
<span id="360">360</span>
<span id="361">361</span>
<span id="362">362</span>
<span id="363">363</span>
<span id="364">364</span>
<span id="365">365</span>
<span id="366">366</span>
<span id="367">367</span>
<span id="368">368</span>
<span id="369">369</span>
<span id="370">370</span>
<span id="371">371</span>
<span id="372">372</span>
<span id="373">373</span>
<span id="374">374</span>
<span id="375">375</span>
<span id="376">376</span>
<span id="377">377</span>
<span id="378">378</span>
<span id="379">379</span>
<span id="380">380</span>
<span id="381">381</span>
<span id="382">382</span>
<span id="383">383</span>
<span id="384">384</span>
<span id="385">385</span>
<span id="386">386</span>
<span id="387">387</span>
<span id="388">388</span>
<span id="389">389</span>
<span id="390">390</span>
<span id="391">391</span>
<span id="392">392</span>
<span id="393">393</span>
<span id="394">394</span>
<span id="395">395</span>
<span id="396">396</span>
<span id="397">397</span>
<span id="398">398</span>
<span id="399">399</span>
<span id="400">400</span>
<span id="401">401</span>
<span id="402">402</span>
<span id="403">403</span>
<span id="404">404</span>
<span id="405">405</span>
<span id="406">406</span>
<span id="407">407</span>
<span id="408">408</span>
<span id="409">409</span>
<span id="410">410</span>
<span id="411">411</span>
<span id="412">412</span>
<span id="413">413</span>
<span id="414">414</span>
<span id="415">415</span>
<span id="416">416</span>
<span id="417">417</span>
<span id="418">418</span>
<span id="419">419</span>
<span id="420">420</span>
<span id="421">421</span>
<span id="422">422</span>
<span id="423">423</span>
<span id="424">424</span>
<span id="425">425</span>
<span id="426">426</span>
<span id="427">427</span>
<span id="428">428</span>
<span id="429">429</span>
<span id="430">430</span>
<span id="431">431</span>
<span id="432">432</span>
<span id="433">433</span>
<span id="434">434</span>
<span id="435">435</span>
<span id="436">436</span>
<span id="437">437</span>
<span id="438">438</span>
<span id="439">439</span>
<span id="440">440</span>
<span id="441">441</span>
<span id="442">442</span>
<span id="443">443</span>
<span id="444">444</span>
<span id="445">445</span>
<span id="446">446</span>
<span id="447">447</span>
<span id="448">448</span>
<span id="449">449</span>
<span id="450">450</span>
<span id="451">451</span>
<span id="452">452</span>
<span id="453">453</span>
<span id="454">454</span>
<span id="455">455</span>
<span id="456">456</span>
<span id="457">457</span>
<span id="458">458</span>
<span id="459">459</span>
<span id="460">460</span>
<span id="461">461</span>
<span id="462">462</span>
<span id="463">463</span>
<span id="464">464</span>
<span id="465">465</span>
<span id="466">466</span>
<span id="467">467</span>
<span id="468">468</span>
<span id="469">469</span>
<span id="470">470</span>
<span id="471">471</span>
<span id="472">472</span>
<span id="473">473</span>
<span id="474">474</span>
<span id="475">475</span>
<span id="476">476</span>
<span id="477">477</span>
<span id="478">478</span>
<span id="479">479</span>
<span id="480">480</span>
<span id="481">481</span>
<span id="482">482</span>
<span id="483">483</span>
<span id="484">484</span>
<span id="485">485</span>
<span id="486">486</span>
<span id="487">487</span>
<span id="488">488</span>
<span id="489">489</span>
<span id="490">490</span>
<span id="491">491</span>
<span id="492">492</span>
<span id="493">493</span>
<span id="494">494</span>
<span id="495">495</span>
<span id="496">496</span>
<span id="497">497</span>
<span id="498">498</span>
<span id="499">499</span>
<span id="500">500</span>
<span id="501">501</span>
<span id="502">502</span>
<span id="503">503</span>
<span id="504">504</span>
<span id="505">505</span>
<span id="506">506</span>
<span id="507">507</span>
<span id="508">508</span>
<span id="509">509</span>
<span id="510">510</span>
<span id="511">511</span>
<span id="512">512</span>
<span id="513">513</span>
<span id="514">514</span>
<span id="515">515</span>
<span id="516">516</span>
<span id="517">517</span>
<span id="518">518</span>
<span id="519">519</span>
<span id="520">520</span>
<span id="521">521</span>
<span id="522">522</span>
<span id="523">523</span>
<span id="524">524</span>
<span id="525">525</span>
<span id="526">526</span>
<span id="527">527</span>
<span id="528">528</span>
<span id="529">529</span>
<span id="530">530</span>
<span id="531">531</span>
<span id="532">532</span>
<span id="533">533</span>
<span id="534">534</span>
<span id="535">535</span>
<span id="536">536</span>
<span id="537">537</span>
<span id="538">538</span>
<span id="539">539</span>
<span id="540">540</span>
<span id="541">541</span>
<span id="542">542</span>
<span id="543">543</span>
<span id="544">544</span>
<span id="545">545</span>
<span id="546">546</span>
<span id="547">547</span>
<span id="548">548</span>
<span id="549">549</span>
<span id="550">550</span>
<span id="551">551</span>
<span id="552">552</span>
<span id="553">553</span>
<span id="554">554</span>
<span id="555">555</span>
<span id="556">556</span>
<span id="557">557</span>
<span id="558">558</span>
<span id="559">559</span>
<span id="560">560</span>
<span id="561">561</span>
<span id="562">562</span>
<span id="563">563</span>
<span id="564">564</span>
<span id="565">565</span>
<span id="566">566</span>
<span id="567">567</span>
<span id="568">568</span>
<span id="569">569</span>
<span id="570">570</span>
<span id="571">571</span>
<span id="572">572</span>
<span id="573">573</span>
<span id="574">574</span>
<span id="575">575</span>
<span id="576">576</span>
<span id="577">577</span>
<span id="578">578</span>
<span id="579">579</span>
<span id="580">580</span>
<span id="581">581</span>
<span id="582">582</span>
<span id="583">583</span>
<span id="584">584</span>
<span id="585">585</span>
<span id="586">586</span>
<span id="587">587</span>
<span id="588">588</span>
<span id="589">589</span>
<span id="590">590</span>
<span id="591">591</span>
<span id="592">592</span>
<span id="593">593</span>
<span id="594">594</span>
<span id="595">595</span>
<span id="596">596</span>
<span id="597">597</span>
<span id="598">598</span>
<span id="599">599</span>
<span id="600">600</span>
<span id="601">601</span>
<span id="602">602</span>
<span id="603">603</span>
<span id="604">604</span>
<span id="605">605</span>
<span id="606">606</span>
<span id="607">607</span>
<span id="608">608</span>
<span id="609">609</span>
<span id="610">610</span>
<span id="611">611</span>
<span id="612">612</span>
<span id="613">613</span>
<span id="614">614</span>
<span id="615">615</span>
<span id="616">616</span>
<span id="617">617</span>
<span id="618">618</span>
<span id="619">619</span>
<span id="620">620</span>
<span id="621">621</span>
<span id="622">622</span>
<span id="623">623</span>
<span id="624">624</span>
<span id="625">625</span>
<span id="626">626</span>
<span id="627">627</span>
<span id="628">628</span>
<span id="629">629</span>
<span id="630">630</span>
<span id="631">631</span>
<span id="632">632</span>
<span id="633">633</span>
<span id="634">634</span>
<span id="635">635</span>
<span id="636">636</span>
<span id="637">637</span>
<span id="638">638</span>
<span id="639">639</span>
<span id="640">640</span>
<span id="641">641</span>
<span id="642">642</span>
<span id="643">643</span>
<span id="644">644</span>
<span id="645">645</span>
<span id="646">646</span>
<span id="647">647</span>
<span id="648">648</span>
<span id="649">649</span>
<span id="650">650</span>
<span id="651">651</span>
<span id="652">652</span>
<span id="653">653</span>
<span id="654">654</span>
<span id="655">655</span>
<span id="656">656</span>
<span id="657">657</span>
<span id="658">658</span>
<span id="659">659</span>
<span id="660">660</span>
<span id="661">661</span>
<span id="662">662</span>
<span id="663">663</span>
<span id="664">664</span>
<span id="665">665</span>
<span id="666">666</span>
<span id="667">667</span>
<span id="668">668</span>
<span id="669">669</span>
<span id="670">670</span>
<span id="671">671</span>
<span id="672">672</span>
<span id="673">673</span>
<span id="674">674</span>
<span id="675">675</span>
<span id="676">676</span>
<span id="677">677</span>
<span id="678">678</span>
<span id="679">679</span>
<span id="680">680</span>
<span id="681">681</span>
<span id="682">682</span>
<span id="683">683</span>
<span id="684">684</span>
<span id="685">685</span>
<span id="686">686</span>
<span id="687">687</span>
<span id="688">688</span>
<span id="689">689</span>
<span id="690">690</span>
<span id="691">691</span>
<span id="692">692</span>
<span id="693">693</span>
<span id="694">694</span>
<span id="695">695</span>
<span id="696">696</span>
<span id="697">697</span>
<span id="698">698</span>
<span id="699">699</span>
<span id="700">700</span>
<span id="701">701</span>
<span id="702">702</span>
<span id="703">703</span>
<span id="704">704</span>
<span id="705">705</span>
<span id="706">706</span>
<span id="707">707</span>
<span id="708">708</span>
<span id="709">709</span>
<span id="710">710</span>
<span id="711">711</span>
<span id="712">712</span>
<span id="713">713</span>
<span id="714">714</span>
<span id="715">715</span>
<span id="716">716</span>
<span id="717">717</span>
<span id="718">718</span>
<span id="719">719</span>
<span id="720">720</span>
<span id="721">721</span>
<span id="722">722</span>
<span id="723">723</span>
<span id="724">724</span>
<span id="725">725</span>
<span id="726">726</span>
<span id="727">727</span>
<span id="728">728</span>
<span id="729">729</span>
<span id="730">730</span>
<span id="731">731</span>
<span id="732">732</span>
<span id="733">733</span>
<span id="734">734</span>
<span id="735">735</span>
<span id="736">736</span>
<span id="737">737</span>
<span id="738">738</span>
<span id="739">739</span>
<span id="740">740</span>
<span id="741">741</span>
<span id="742">742</span>
<span id="743">743</span>
<span id="744">744</span>
<span id="745">745</span>
<span id="746">746</span>
<span id="747">747</span>
<span id="748">748</span>
<span id="749">749</span>
<span id="750">750</span>
<span id="751">751</span>
<span id="752">752</span>
<span id="753">753</span>
<span id="754">754</span>
<span id="755">755</span>
<span id="756">756</span>
<span id="757">757</span>
<span id="758">758</span>
<span id="759">759</span>
<span id="760">760</span>
<span id="761">761</span>
<span id="762">762</span>
<span id="763">763</span>
<span id="764">764</span>
<span id="765">765</span>
<span id="766">766</span>
<span id="767">767</span>
<span id="768">768</span>
<span id="769">769</span>
</pre><pre class="rust"><code><span class="doccomment">/*!
# OpenGL ES3 API (aka GLES3).

Designed to work on Linux and Android, with context provided by EGL.

## Texture views

GLES3 doesn&#39;t really have separate texture view objects. We have to remember the
original texture and the sub-range into it. Problem is, however, that there is
no way to expose a subset of array layers or mip levels of a sampled texture.

## Binding model

Binding model is very different from WebGPU, especially with regards to samplers.
GLES3 has sampler objects, but they aren&#39;t separately bindable to the shaders.
Each sampled texture is exposed to the shader as a combined texture-sampler binding.

When building the pipeline layout, we linearize binding entries based on the groups
(uniform/storage buffers, uniform/storage textures), and record the mapping into
`BindGroupLayoutInfo`.
When a pipeline gets created, and we track all the texture-sampler associations
from the static use in the shader.
We only support at most one sampler used with each texture so far. The linear index
of this sampler is stored per texture slot in `SamplerBindMap` array.

The texture-sampler pairs get potentially invalidated in 2 places:
  - when a new pipeline is set, we update the linear indices of associated samplers
  - when a new bind group is set, we update both the textures and the samplers

We expect that the changes to sampler states between any 2 pipelines of the same layout
will be minimal, if any.

## Vertex data

Generally, vertex buffers are marked as dirty and lazily bound on draw.

GLES3 doesn&#39;t support &quot;base instance&quot; semantics. However, it&#39;s easy to support,
since we are forced to do late binding anyway. We just adjust the offsets
into the vertex data.

### Old path

In GLES-3.0 and WebGL2, vertex buffer layout is provided
together with the actual buffer binding.
We invalidate the attributes on the vertex buffer change, and re-bind them.

### New path

In GLES-3.1 and higher, the vertex buffer layout can be declared separately
from the vertex data itself. This mostly matches WebGPU, however there is a catch:
`stride` needs to be specified with the data, not as a part of the layout.

To address this, we invalidate the vertex buffers based on:
  - whether or not `start_instance` is used
  - stride has changed

*/

///cbindgen:ignore
</span><span class="attribute">#[cfg(any(not(target_arch = <span class="string">&quot;wasm32&quot;</span>), feature = <span class="string">&quot;emscripten&quot;</span>))]
</span><span class="kw">mod </span>egl;
<span class="attribute">#[cfg(all(target_arch = <span class="string">&quot;wasm32&quot;</span>, not(feature = <span class="string">&quot;emscripten&quot;</span>)))]
</span><span class="kw">mod </span>web;

<span class="kw">mod </span>adapter;
<span class="kw">mod </span>command;
<span class="kw">mod </span>conv;
<span class="kw">mod </span>device;
<span class="kw">mod </span>queue;

<span class="attribute">#[cfg(any(not(target_arch = <span class="string">&quot;wasm32&quot;</span>), feature = <span class="string">&quot;emscripten&quot;</span>))]
</span><span class="kw">pub use </span><span class="self">self</span>::egl::{AdapterContext, AdapterContextLock};
<span class="attribute">#[cfg(any(not(target_arch = <span class="string">&quot;wasm32&quot;</span>), feature = <span class="string">&quot;emscripten&quot;</span>))]
</span><span class="kw">use </span><span class="self">self</span>::egl::{Instance, Surface};

<span class="attribute">#[cfg(all(target_arch = <span class="string">&quot;wasm32&quot;</span>, not(feature = <span class="string">&quot;emscripten&quot;</span>)))]
</span><span class="kw">pub use </span><span class="self">self</span>::web::AdapterContext;
<span class="attribute">#[cfg(all(target_arch = <span class="string">&quot;wasm32&quot;</span>, not(feature = <span class="string">&quot;emscripten&quot;</span>)))]
</span><span class="kw">use </span><span class="self">self</span>::web::{Instance, Surface};

<span class="kw">use </span>arrayvec::ArrayVec;

<span class="kw">use </span>glow::HasContext;

<span class="kw">use </span>std::{ops::Range, sync::Arc};

<span class="attribute">#[derive(Clone)]
</span><span class="kw">pub struct </span>Api;

<span class="comment">//Note: we can support more samplers if not every one of them is used at a time,
// but it probably doesn&#39;t worth it.
</span><span class="kw">const </span>MAX_TEXTURE_SLOTS: usize = <span class="number">16</span>;
<span class="kw">const </span>MAX_SAMPLERS: usize = <span class="number">16</span>;
<span class="kw">const </span>MAX_VERTEX_ATTRIBUTES: usize = <span class="number">16</span>;
<span class="kw">const </span>ZERO_BUFFER_SIZE: usize = <span class="number">256 </span>&lt;&lt; <span class="number">10</span>;
<span class="kw">const </span>MAX_PUSH_CONSTANTS: usize = <span class="number">16</span>;

<span class="kw">impl </span><span class="kw">crate</span>::Api <span class="kw">for </span>Api {
    <span class="kw">type </span>Instance = Instance;
    <span class="kw">type </span>Surface = Surface;
    <span class="kw">type </span>Adapter = Adapter;
    <span class="kw">type </span>Device = Device;

    <span class="kw">type </span>Queue = Queue;
    <span class="kw">type </span>CommandEncoder = CommandEncoder;
    <span class="kw">type </span>CommandBuffer = CommandBuffer;

    <span class="kw">type </span>Buffer = Buffer;
    <span class="kw">type </span>Texture = Texture;
    <span class="kw">type </span>SurfaceTexture = Texture;
    <span class="kw">type </span>TextureView = TextureView;
    <span class="kw">type </span>Sampler = Sampler;
    <span class="kw">type </span>QuerySet = QuerySet;
    <span class="kw">type </span>Fence = Fence;

    <span class="kw">type </span>BindGroupLayout = BindGroupLayout;
    <span class="kw">type </span>BindGroup = BindGroup;
    <span class="kw">type </span>PipelineLayout = PipelineLayout;
    <span class="kw">type </span>ShaderModule = ShaderModule;
    <span class="kw">type </span>RenderPipeline = RenderPipeline;
    <span class="kw">type </span>ComputePipeline = ComputePipeline;
}

<span class="macro">bitflags::bitflags! </span>{
    <span class="doccomment">/// Flags that affect internal code paths but do not
    /// change the exposed feature set.
    </span><span class="kw">struct </span>PrivateCapabilities: u32 {
        <span class="doccomment">/// Indicates support for `glBufferStorage` allocation.
        </span><span class="kw">const </span>BUFFER_ALLOCATION = <span class="number">1 </span>&lt;&lt; <span class="number">0</span>;
        <span class="doccomment">/// Support explicit layouts in shader.
        </span><span class="kw">const </span>SHADER_BINDING_LAYOUT = <span class="number">1 </span>&lt;&lt; <span class="number">1</span>;
        <span class="doccomment">/// Support extended shadow sampling instructions.
        </span><span class="kw">const </span>SHADER_TEXTURE_SHADOW_LOD = <span class="number">1 </span>&lt;&lt; <span class="number">2</span>;
        <span class="doccomment">/// Support memory barriers.
        </span><span class="kw">const </span>MEMORY_BARRIERS = <span class="number">1 </span>&lt;&lt; <span class="number">3</span>;
        <span class="doccomment">/// Vertex buffer layouts separate from the data.
        </span><span class="kw">const </span>VERTEX_BUFFER_LAYOUT = <span class="number">1 </span>&lt;&lt; <span class="number">4</span>;
        <span class="doccomment">/// Indicates that buffers used as `GL_ELEMENT_ARRAY_BUFFER` may be created / initialized / used
        /// as other targets, if not present they must not be mixed with other targets.
        </span><span class="kw">const </span>INDEX_BUFFER_ROLE_CHANGE = <span class="number">1 </span>&lt;&lt; <span class="number">5</span>;
        <span class="doccomment">/// Indicates that the device supports disabling draw buffers
        </span><span class="kw">const </span>CAN_DISABLE_DRAW_BUFFER = <span class="number">1 </span>&lt;&lt; <span class="number">6</span>;
        <span class="doccomment">/// Supports `glGetBufferSubData`
        </span><span class="kw">const </span>GET_BUFFER_SUB_DATA = <span class="number">1 </span>&lt;&lt; <span class="number">7</span>;
        <span class="doccomment">/// Supports `f16` color buffers
        </span><span class="kw">const </span>COLOR_BUFFER_HALF_FLOAT = <span class="number">1 </span>&lt;&lt; <span class="number">8</span>;
        <span class="doccomment">/// Supports `f11/f10` and `f32` color buffers
        </span><span class="kw">const </span>COLOR_BUFFER_FLOAT = <span class="number">1 </span>&lt;&lt; <span class="number">9</span>;
    }
}

<span class="macro">bitflags::bitflags! </span>{
    <span class="doccomment">/// Flags that indicate necessary workarounds for specific devices or driver bugs
    </span><span class="kw">struct </span>Workarounds: u32 {
        <span class="comment">// Needs workaround for Intel Mesa bug:
        // https://gitlab.freedesktop.org/mesa/mesa/-/issues/2565.
        //
        // This comment
        // (https://gitlab.freedesktop.org/mesa/mesa/-/merge_requests/4972/diffs?diff_id=75888#22f5d1004713c9bbf857988c7efb81631ab88f99_323_327)
        // seems to indicate all skylake models are effected.
        </span><span class="kw">const </span>MESA_I915_SRGB_SHADER_CLEAR = <span class="number">1 </span>&lt;&lt; <span class="number">0</span>;
        <span class="doccomment">/// Buffer map must emulated becuase it is not supported natively
        </span><span class="kw">const </span>EMULATE_BUFFER_MAP = <span class="number">1 </span>&lt;&lt; <span class="number">1</span>;
    }
}

<span class="kw">type </span>BindTarget = u32;

<span class="attribute">#[derive(Debug, Clone, Copy)]
</span><span class="kw">enum </span>VertexAttribKind {
    Float, <span class="comment">// glVertexAttribPointer
    </span>Integer, <span class="comment">// glVertexAttribIPointer
           //Double,  // glVertexAttribLPointer
</span>}

<span class="kw">impl </span>Default <span class="kw">for </span>VertexAttribKind {
    <span class="kw">fn </span>default() -&gt; <span class="self">Self </span>{
        <span class="self">Self</span>::Float
    }
}

<span class="attribute">#[derive(Clone, Debug)]
</span><span class="kw">struct </span>TextureFormatDesc {
    internal: u32,
    external: u32,
    data_type: u32,
}

<span class="kw">struct </span>AdapterShared {
    context: AdapterContext,
    private_caps: PrivateCapabilities,
    features: wgt::Features,
    workarounds: Workarounds,
    shading_language_version: naga::back::glsl::Version,
    max_texture_size: u32,
}

<span class="kw">pub struct </span>Adapter {
    shared: Arc&lt;AdapterShared&gt;,
}

<span class="kw">pub struct </span>Device {
    shared: Arc&lt;AdapterShared&gt;,
    main_vao: glow::VertexArray,
    <span class="attribute">#[cfg(feature = <span class="string">&quot;renderdoc&quot;</span>)]
    </span>render_doc: <span class="kw">crate</span>::auxil::renderdoc::RenderDoc,
}

<span class="kw">pub struct </span>Queue {
    shared: Arc&lt;AdapterShared&gt;,
    features: wgt::Features,
    draw_fbo: glow::Framebuffer,
    copy_fbo: glow::Framebuffer,
    <span class="doccomment">/// Shader program used to clear the screen for [`Workarounds::MESA_I915_SRGB_SHADER_CLEAR`]
    /// devices.
    </span>shader_clear_program: glow::Program,
    <span class="doccomment">/// The uniform location of the color uniform in the shader clear program
    </span>shader_clear_program_color_uniform_location: glow::UniformLocation,
    <span class="doccomment">/// Keep a reasonably large buffer filled with zeroes, so that we can implement `ClearBuffer` of
    /// zeroes by copying from it.
    </span>zero_buffer: glow::Buffer,
    temp_query_results: Vec&lt;u64&gt;,
    draw_buffer_count: u8,
    current_index_buffer: <span class="prelude-ty">Option</span>&lt;glow::Buffer&gt;,
}

<span class="attribute">#[derive(Clone, Debug)]
</span><span class="kw">pub struct </span>Buffer {
    raw: <span class="prelude-ty">Option</span>&lt;glow::Buffer&gt;,
    target: BindTarget,
    size: wgt::BufferAddress,
    map_flags: u32,
    data: <span class="prelude-ty">Option</span>&lt;Arc&lt;std::sync::Mutex&lt;Vec&lt;u8&gt;&gt;&gt;&gt;,
}

<span class="comment">// Safe: WASM doesn&#39;t have threads
</span><span class="attribute">#[cfg(target_arch = <span class="string">&quot;wasm32&quot;</span>)]
</span><span class="kw">unsafe impl </span>Sync <span class="kw">for </span>Buffer {}
<span class="attribute">#[cfg(target_arch = <span class="string">&quot;wasm32&quot;</span>)]
</span><span class="kw">unsafe impl </span>Send <span class="kw">for </span>Buffer {}

<span class="attribute">#[derive(Clone, Debug)]
</span><span class="kw">enum </span>TextureInner {
    Renderbuffer {
        raw: glow::Renderbuffer,
    },
    DefaultRenderbuffer,
    Texture {
        raw: glow::Texture,
        target: BindTarget,
    },
}

<span class="kw">impl </span>TextureInner {
    <span class="kw">fn </span>as_native(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; (glow::Texture, BindTarget) {
        <span class="kw">match </span><span class="kw-2">*</span><span class="self">self </span>{
            <span class="self">Self</span>::Renderbuffer { .. } | <span class="self">Self</span>::DefaultRenderbuffer =&gt; {
                <span class="macro">panic!</span>(<span class="string">&quot;Unexpected renderbuffer&quot;</span>);
            }
            <span class="self">Self</span>::Texture { raw, target } =&gt; (raw, target),
        }
    }
}

<span class="attribute">#[derive(Debug)]
</span><span class="kw">pub struct </span>Texture {
    inner: TextureInner,
    mip_level_count: u32,
    array_layer_count: u32,
    format: wgt::TextureFormat,
    <span class="attribute">#[allow(unused)]
    </span>format_desc: TextureFormatDesc,
    copy_size: <span class="kw">crate</span>::CopyExtent,
    is_cubemap: bool,
}

<span class="kw">impl </span>Texture {
    <span class="kw">pub fn </span>default_framebuffer(format: wgt::TextureFormat) -&gt; <span class="self">Self </span>{
        <span class="self">Self </span>{
            inner: TextureInner::DefaultRenderbuffer,
            mip_level_count: <span class="number">1</span>,
            array_layer_count: <span class="number">1</span>,
            format,
            format_desc: TextureFormatDesc {
                internal: <span class="number">0</span>,
                external: <span class="number">0</span>,
                data_type: <span class="number">0</span>,
            },
            copy_size: <span class="kw">crate</span>::CopyExtent {
                width: <span class="number">0</span>,
                height: <span class="number">0</span>,
                depth: <span class="number">0</span>,
            },
            is_cubemap: <span class="bool-val">false</span>,
        }
    }
}

<span class="attribute">#[derive(Clone, Debug)]
</span><span class="kw">pub struct </span>TextureView {
    inner: TextureInner,
    sample_type: wgt::TextureSampleType,
    aspects: <span class="kw">crate</span>::FormatAspects,
    mip_levels: Range&lt;u32&gt;,
    array_layers: Range&lt;u32&gt;,
    format: wgt::TextureFormat,
}

<span class="attribute">#[derive(Debug)]
</span><span class="kw">pub struct </span>Sampler {
    raw: glow::Sampler,
}

<span class="kw">pub struct </span>BindGroupLayout {
    entries: Arc&lt;[wgt::BindGroupLayoutEntry]&gt;,
}

<span class="kw">struct </span>BindGroupLayoutInfo {
    entries: Arc&lt;[wgt::BindGroupLayoutEntry]&gt;,
    <span class="doccomment">/// Mapping of resources, indexed by `binding`, into the whole layout space.
    /// For texture resources, the value is the texture slot index.
    /// For sampler resources, the value is the index of the sampler in the whole layout.
    /// For buffers, the value is the uniform or storage slot index.
    /// For unused bindings, the value is `!0`
    </span>binding_to_slot: Box&lt;[u8]&gt;,
}

<span class="kw">pub struct </span>PipelineLayout {
    group_infos: Box&lt;[BindGroupLayoutInfo]&gt;,
    naga_options: naga::back::glsl::Options,
}

<span class="kw">impl </span>PipelineLayout {
    <span class="kw">fn </span>get_slot(<span class="kw-2">&amp;</span><span class="self">self</span>, br: <span class="kw-2">&amp;</span>naga::ResourceBinding) -&gt; u8 {
        <span class="kw">let </span>group_info = <span class="kw-2">&amp;</span><span class="self">self</span>.group_infos[br.group <span class="kw">as </span>usize];
        group_info.binding_to_slot[br.binding <span class="kw">as </span>usize]
    }
}

<span class="attribute">#[derive(Debug)]
</span><span class="kw">enum </span>BindingRegister {
    UniformBuffers,
    StorageBuffers,
    Textures,
    Images,
}

<span class="attribute">#[derive(Debug)]
</span><span class="kw">enum </span>RawBinding {
    Buffer {
        raw: glow::Buffer,
        offset: i32,
        size: i32,
    },
    Texture {
        raw: glow::Texture,
        target: BindTarget,
        <span class="comment">//TODO: mip levels, array layers
    </span>},
    Image(ImageBinding),
    Sampler(glow::Sampler),
}

<span class="attribute">#[derive(Debug)]
</span><span class="kw">pub struct </span>BindGroup {
    contents: Box&lt;[RawBinding]&gt;,
}

<span class="attribute">#[derive(Debug)]
</span><span class="kw">pub struct </span>ShaderModule {
    naga: <span class="kw">crate</span>::NagaShader,
    label: <span class="prelude-ty">Option</span>&lt;String&gt;,
}

<span class="attribute">#[derive(Clone, Debug, Default)]
</span><span class="kw">struct </span>VertexFormatDesc {
    element_count: i32,
    element_format: u32,
    attrib_kind: VertexAttribKind,
}

<span class="attribute">#[derive(Clone, Debug, Default)]
</span><span class="kw">struct </span>AttributeDesc {
    location: u32,
    offset: u32,
    buffer_index: u32,
    format_desc: VertexFormatDesc,
}

<span class="attribute">#[derive(Clone, Debug)]
</span><span class="kw">struct </span>BufferBinding {
    raw: glow::Buffer,
    offset: wgt::BufferAddress,
}

<span class="attribute">#[derive(Clone, Debug)]
</span><span class="kw">struct </span>ImageBinding {
    raw: glow::Texture,
    mip_level: u32,
    array_layer: <span class="prelude-ty">Option</span>&lt;u32&gt;,
    access: u32,
    format: u32,
}

<span class="attribute">#[derive(Clone, Debug, Default, PartialEq)]
</span><span class="kw">struct </span>VertexBufferDesc {
    step: wgt::VertexStepMode,
    stride: u32,
}

<span class="attribute">#[derive(Clone, Debug, Default)]
</span><span class="kw">struct </span>UniformDesc {
    location: <span class="prelude-ty">Option</span>&lt;glow::UniformLocation&gt;,
    size: u32,
    utype: u32,
}

<span class="comment">// Safe: WASM doesn&#39;t have threads
</span><span class="attribute">#[cfg(target_arch = <span class="string">&quot;wasm32&quot;</span>)]
</span><span class="kw">unsafe impl </span>Sync <span class="kw">for </span>UniformDesc {}
<span class="attribute">#[cfg(target_arch = <span class="string">&quot;wasm32&quot;</span>)]
</span><span class="kw">unsafe impl </span>Send <span class="kw">for </span>UniformDesc {}

<span class="doccomment">/// For each texture in the pipeline layout, store the index of the only
/// sampler (in this layout) that the texture is used with.
</span><span class="kw">type </span>SamplerBindMap = [<span class="prelude-ty">Option</span>&lt;u8&gt;; MAX_TEXTURE_SLOTS];

<span class="kw">struct </span>PipelineInner {
    program: glow::Program,
    sampler_map: SamplerBindMap,
    uniforms: [UniformDesc; MAX_PUSH_CONSTANTS],
}

<span class="attribute">#[derive(Clone, Debug)]
</span><span class="kw">struct </span>DepthState {
    function: u32,
    mask: bool,
}

<span class="attribute">#[derive(Clone, Debug, PartialEq)]
</span><span class="kw">struct </span>BlendComponent {
    src: u32,
    dst: u32,
    equation: u32,
}

<span class="attribute">#[derive(Clone, Debug, PartialEq)]
</span><span class="kw">struct </span>BlendDesc {
    alpha: BlendComponent,
    color: BlendComponent,
}

<span class="attribute">#[derive(Clone, Debug, Default, PartialEq)]
</span><span class="kw">struct </span>ColorTargetDesc {
    mask: wgt::ColorWrites,
    blend: <span class="prelude-ty">Option</span>&lt;BlendDesc&gt;,
}

<span class="kw">pub struct </span>RenderPipeline {
    inner: PipelineInner,
    primitive: wgt::PrimitiveState,
    vertex_buffers: Box&lt;[VertexBufferDesc]&gt;,
    vertex_attributes: Box&lt;[AttributeDesc]&gt;,
    color_targets: Box&lt;[ColorTargetDesc]&gt;,
    depth: <span class="prelude-ty">Option</span>&lt;DepthState&gt;,
    depth_bias: wgt::DepthBiasState,
    stencil: <span class="prelude-ty">Option</span>&lt;StencilState&gt;,
}

<span class="comment">// SAFE: WASM doesn&#39;t have threads
</span><span class="attribute">#[cfg(target_arch = <span class="string">&quot;wasm32&quot;</span>)]
</span><span class="kw">unsafe impl </span>Send <span class="kw">for </span>RenderPipeline {}
<span class="attribute">#[cfg(target_arch = <span class="string">&quot;wasm32&quot;</span>)]
</span><span class="kw">unsafe impl </span>Sync <span class="kw">for </span>RenderPipeline {}

<span class="kw">pub struct </span>ComputePipeline {
    inner: PipelineInner,
}

<span class="comment">// SAFE: WASM doesn&#39;t have threads
</span><span class="attribute">#[cfg(target_arch = <span class="string">&quot;wasm32&quot;</span>)]
</span><span class="kw">unsafe impl </span>Send <span class="kw">for </span>ComputePipeline {}
<span class="attribute">#[cfg(target_arch = <span class="string">&quot;wasm32&quot;</span>)]
</span><span class="kw">unsafe impl </span>Sync <span class="kw">for </span>ComputePipeline {}

<span class="attribute">#[derive(Debug)]
</span><span class="kw">pub struct </span>QuerySet {
    queries: Box&lt;[glow::Query]&gt;,
    target: BindTarget,
}

<span class="attribute">#[derive(Debug)]
</span><span class="kw">pub struct </span>Fence {
    last_completed: <span class="kw">crate</span>::FenceValue,
    pending: Vec&lt;(<span class="kw">crate</span>::FenceValue, glow::Fence)&gt;,
}

<span class="kw">unsafe impl </span>Send <span class="kw">for </span>Fence {}
<span class="kw">unsafe impl </span>Sync <span class="kw">for </span>Fence {}

<span class="kw">impl </span>Fence {
    <span class="kw">fn </span>get_latest(<span class="kw-2">&amp;</span><span class="self">self</span>, gl: <span class="kw-2">&amp;</span>glow::Context) -&gt; <span class="kw">crate</span>::FenceValue {
        <span class="kw">let </span><span class="kw-2">mut </span>max_value = <span class="self">self</span>.last_completed;
        <span class="kw">for </span><span class="kw-2">&amp;</span>(value, sync) <span class="kw">in </span><span class="self">self</span>.pending.iter() {
            <span class="kw">let </span>status = <span class="kw">unsafe </span>{ gl.get_sync_status(sync) };
            <span class="kw">if </span>status == glow::SIGNALED {
                max_value = value;
            }
        }
        max_value
    }

    <span class="kw">fn </span>maintain(<span class="kw-2">&amp;mut </span><span class="self">self</span>, gl: <span class="kw-2">&amp;</span>glow::Context) {
        <span class="kw">let </span>latest = <span class="self">self</span>.get_latest(gl);
        <span class="kw">for </span><span class="kw-2">&amp;</span>(value, sync) <span class="kw">in </span><span class="self">self</span>.pending.iter() {
            <span class="kw">if </span>value &lt;= latest {
                <span class="kw">unsafe </span>{
                    gl.delete_sync(sync);
                }
            }
        }
        <span class="self">self</span>.pending.retain(|<span class="kw-2">&amp;</span>(value, <span class="kw">_</span>)| value &gt; latest);
        <span class="self">self</span>.last_completed = latest;
    }
}

<span class="attribute">#[derive(Clone, Debug, PartialEq)]
</span><span class="kw">struct </span>StencilOps {
    pass: u32,
    fail: u32,
    depth_fail: u32,
}

<span class="kw">impl </span>Default <span class="kw">for </span>StencilOps {
    <span class="kw">fn </span>default() -&gt; <span class="self">Self </span>{
        <span class="self">Self </span>{
            pass: glow::KEEP,
            fail: glow::KEEP,
            depth_fail: glow::KEEP,
        }
    }
}

<span class="attribute">#[derive(Clone, Debug, PartialEq)]
</span><span class="kw">struct </span>StencilSide {
    function: u32,
    mask_read: u32,
    mask_write: u32,
    reference: u32,
    ops: StencilOps,
}

<span class="kw">impl </span>Default <span class="kw">for </span>StencilSide {
    <span class="kw">fn </span>default() -&gt; <span class="self">Self </span>{
        <span class="self">Self </span>{
            function: glow::ALWAYS,
            mask_read: <span class="number">0xFF</span>,
            mask_write: <span class="number">0xFF</span>,
            reference: <span class="number">0</span>,
            ops: StencilOps::default(),
        }
    }
}

<span class="attribute">#[derive(Clone, Default)]
</span><span class="kw">struct </span>StencilState {
    front: StencilSide,
    back: StencilSide,
}

<span class="attribute">#[derive(Clone, Debug, Default, PartialEq)]
</span><span class="kw">struct </span>PrimitiveState {
    front_face: u32,
    cull_face: u32,
    unclipped_depth: bool,
}

<span class="kw">type </span>InvalidatedAttachments = ArrayVec&lt;u32, { <span class="kw">crate</span>::MAX_COLOR_ATTACHMENTS + <span class="number">2 </span>}&gt;;

<span class="attribute">#[derive(Debug)]
</span><span class="kw">enum </span>Command {
    Draw {
        topology: u32,
        start_vertex: u32,
        vertex_count: u32,
        instance_count: u32,
    },
    DrawIndexed {
        topology: u32,
        index_type: u32,
        index_count: u32,
        index_offset: wgt::BufferAddress,
        base_vertex: i32,
        instance_count: u32,
    },
    DrawIndirect {
        topology: u32,
        indirect_buf: glow::Buffer,
        indirect_offset: wgt::BufferAddress,
    },
    DrawIndexedIndirect {
        topology: u32,
        index_type: u32,
        indirect_buf: glow::Buffer,
        indirect_offset: wgt::BufferAddress,
    },
    Dispatch([u32; <span class="number">3</span>]),
    DispatchIndirect {
        indirect_buf: glow::Buffer,
        indirect_offset: wgt::BufferAddress,
    },
    ClearBuffer {
        dst: Buffer,
        dst_target: BindTarget,
        range: <span class="kw">crate</span>::MemoryRange,
    },
    CopyBufferToBuffer {
        src: Buffer,
        src_target: BindTarget,
        dst: Buffer,
        dst_target: BindTarget,
        copy: <span class="kw">crate</span>::BufferCopy,
    },
    CopyTextureToTexture {
        src: glow::Texture,
        src_target: BindTarget,
        dst: glow::Texture,
        dst_target: BindTarget,
        copy: <span class="kw">crate</span>::TextureCopy,
        dst_is_cubemap: bool,
    },
    CopyBufferToTexture {
        src: Buffer,
        <span class="attribute">#[allow(unused)]
        </span>src_target: BindTarget,
        dst: glow::Texture,
        dst_target: BindTarget,
        dst_format: wgt::TextureFormat,
        copy: <span class="kw">crate</span>::BufferTextureCopy,
    },
    CopyTextureToBuffer {
        src: glow::Texture,
        src_target: BindTarget,
        src_format: wgt::TextureFormat,
        dst: Buffer,
        <span class="attribute">#[allow(unused)]
        </span>dst_target: BindTarget,
        copy: <span class="kw">crate</span>::BufferTextureCopy,
    },
    SetIndexBuffer(glow::Buffer),
    BeginQuery(glow::Query, BindTarget),
    EndQuery(BindTarget),
    CopyQueryResults {
        query_range: Range&lt;u32&gt;,
        dst: Buffer,
        dst_target: BindTarget,
        dst_offset: wgt::BufferAddress,
    },
    ResetFramebuffer {
        is_default: bool,
    },
    BindAttachment {
        attachment: u32,
        view: TextureView,
    },
    ResolveAttachment {
        attachment: u32,
        dst: TextureView,
        size: wgt::Extent3d,
    },
    InvalidateAttachments(InvalidatedAttachments),
    SetDrawColorBuffers(u8),
    ClearColorF {
        draw_buffer: u32,
        color: [f32; <span class="number">4</span>],
        is_srgb: bool,
    },
    ClearColorU(u32, [u32; <span class="number">4</span>]),
    ClearColorI(u32, [i32; <span class="number">4</span>]),
    ClearDepth(f32),
    ClearStencil(u32),
    <span class="comment">// Clearing both the depth and stencil buffer individually appears to
    // result in the stencil buffer failing to clear, atleast in WebGL.
    // It is also more efficient to emit a single command instead of two for
    // this.
    </span>ClearDepthAndStencil(f32, u32),
    BufferBarrier(glow::Buffer, <span class="kw">crate</span>::BufferUses),
    TextureBarrier(<span class="kw">crate</span>::TextureUses),
    SetViewport {
        rect: <span class="kw">crate</span>::Rect&lt;i32&gt;,
        depth: Range&lt;f32&gt;,
    },
    SetScissor(<span class="kw">crate</span>::Rect&lt;i32&gt;),
    SetStencilFunc {
        face: u32,
        function: u32,
        reference: u32,
        read_mask: u32,
    },
    SetStencilOps {
        face: u32,
        write_mask: u32,
        ops: StencilOps,
    },
    SetDepth(DepthState),
    SetDepthBias(wgt::DepthBiasState),
    ConfigureDepthStencil(<span class="kw">crate</span>::FormatAspects),
    SetVertexAttribute {
        buffer: <span class="prelude-ty">Option</span>&lt;glow::Buffer&gt;,
        buffer_desc: VertexBufferDesc,
        attribute_desc: AttributeDesc,
    },
    UnsetVertexAttribute(u32),
    SetVertexBuffer {
        index: u32,
        buffer: BufferBinding,
        buffer_desc: VertexBufferDesc,
    },
    SetProgram(glow::Program),
    SetPrimitive(PrimitiveState),
    SetBlendConstant([f32; <span class="number">4</span>]),
    SetColorTarget {
        draw_buffer_index: <span class="prelude-ty">Option</span>&lt;u32&gt;,
        desc: ColorTargetDesc,
    },
    BindBuffer {
        target: BindTarget,
        slot: u32,
        buffer: glow::Buffer,
        offset: i32,
        size: i32,
    },
    BindSampler(u32, <span class="prelude-ty">Option</span>&lt;glow::Sampler&gt;),
    BindTexture {
        slot: u32,
        texture: glow::Texture,
        target: BindTarget,
    },
    BindImage {
        slot: u32,
        binding: ImageBinding,
    },
    InsertDebugMarker(Range&lt;u32&gt;),
    PushDebugGroup(Range&lt;u32&gt;),
    PopDebugGroup,
    SetPushConstants {
        uniform: UniformDesc,
        <span class="doccomment">/// Offset from the start of the `data_bytes`
        </span>offset: u32,
    },
}

<span class="attribute">#[derive(Default)]
</span><span class="kw">pub struct </span>CommandBuffer {
    label: <span class="prelude-ty">Option</span>&lt;String&gt;,
    commands: Vec&lt;Command&gt;,
    data_bytes: Vec&lt;u8&gt;,
    queries: Vec&lt;glow::Query&gt;,
}

<span class="comment">//TODO: we would have something like `Arc&lt;typed_arena::Arena&gt;`
// here and in the command buffers. So that everything grows
// inside the encoder and stays there until `reset_all`.

</span><span class="kw">pub struct </span>CommandEncoder {
    cmd_buffer: CommandBuffer,
    state: command::State,
    private_caps: PrivateCapabilities,
}
</code></pre></div>
</section></div></main><div id="rustdoc-vars" data-root-path="../../../" data-current-crate="wgpu_hal" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.65.0-nightly (060e47f74 2022-08-23)" ></div></body></html>